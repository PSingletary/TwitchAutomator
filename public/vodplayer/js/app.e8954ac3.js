(function(){"use strict";var e={812:function(e,t,s){var i=s(242),n=s(396),o=s(139);const a={key:0,ref:"app",id:"app"},l={ref:"player",id:"player"},r={id:"video_container"},h={key:0,class:"meme-bg"},c={key:0,class:"meme"},d=(0,n._)("img",{src:"https://i.imgur.com/YmMUr7z.gif",rel:"noreferrer"},null,-1),u=[d],m=(0,n._)("div",{id:"osd"},"SYNC NOT STARTED",-1),p={key:1,id:"controls"},v={class:"option-row"},g=(0,n._)("div",{class:"option-title"},"Video",-1),y={class:"option-content"},f=(0,n._)("option",{value:"file"},"Local video file",-1),b=(0,n._)("option",{value:"file_http"},"Hosted video file",-1),_=(0,n._)("option",{value:"youtube"},"YouTube",-1),w=(0,n._)("option",{value:"twitch"},"Twitch VOD",-1),k=[f,b,_,w],C=(0,n._)("hr",null,null,-1),T={key:0},P={class:"control fullwidth"},L={type:"file",name:"video-input",ref:"video_input",accept:"video/*"},S={key:1},E={class:"control fullwidth"},x={type:"text",name:"video-input",ref:"video_input",placeholder:"Video URL"},O={key:2},D={class:"control fullwidth"},U={type:"text",name:"video-input",ref:"video_input",placeholder:"YouTube URL"},I={key:3},Z={class:"control fullwidth"},$={type:"text",name:"video-input",ref:"video_input",placeholder:"Twitch VOD URL"},V=(0,n._)("p",{class:"help-text"},[(0,n.Uk)(" Please proceed through the mature warning before clicking start, if it appears."),(0,n._)("br"),(0,n.Uk)(" This feature requires Twitch API credentials. ")],-1),A=(0,n._)("hr",null,null,-1),N=(0,n._)("div",{class:"option-title"},"Chat",-1),R={class:"option-content"},F=(0,n._)("option",{value:"file"},"Local chat file",-1),j=(0,n._)("option",{value:"file_http"},"Hosted chat file",-1),q=(0,n._)("option",{value:"twitch"},"Twitch API VOD dump",-1),z=[F,j,q],B=(0,n._)("hr",null,null,-1),M={key:0},H={class:"control fullwidth"},Y={type:"file",name:"chat-input",ref:"chat_input",accept:"application/json,.chatdump",placeholder:"Chat"},W={key:1},Q={class:"control fullwidth"},K={type:"url",name:"chat-input",ref:"chat_input",placeholder:"Chat URL"},G={key:2},J={class:"control fullwidth"},X={type:"url",name:"chat-input",ref:"chat_input",placeholder:"Twitch VOD URL"},ee=(0,n._)("hr",null,null,-1),te=(0,n._)("p",{class:"help-text"},"Chat logs may take a while to parse, don't worry.",-1),se={key:2,class:"option-group"},ie=(0,n._)("div",{class:"option-title"},"Twitch API",-1),ne={class:"option-content"},oe=(0,n.Uk)(" Client ID "),ae=(0,n.Uk)(" Secret "),le=(0,n._)("br",null,null,-1),re={class:"is-error"},he=(0,n._)("br",null,null,-1),ce={class:"option-group"},de=(0,n._)("div",{class:"option-title"},"Status",-1),ue={class:"option-content"},me=(0,n._)("strong",null,"Video:",-1),pe=(0,n.Uk)(),ve=(0,n._)("br",null,null,-1),ge=(0,n._)("strong",null,"Comments:",-1),ye=(0,n.Uk)(),fe=(0,n._)("br",null,null,-1),be=(0,n._)("strong",null,"FFZ:",-1),_e=(0,n.Uk)(),we=(0,n._)("br",null,null,-1),ke=(0,n._)("strong",null,"BTTV Channel:",-1),Ce=(0,n.Uk)(),Te=(0,n._)("br",null,null,-1),Pe=(0,n._)("strong",null,"BTTV Global:",-1),Le=(0,n.Uk)(),Se=(0,n._)("br",null,null,-1),Ee=(0,n._)("strong",null,"SevenTV:",-1),xe=(0,n.Uk)(),Oe={class:"option-row"},De={key:0,class:"option-group"},Ue=(0,n._)("div",{class:"option-title"},"Chat offset in seconds",-1),Ie={class:"option-content"},Ze=(0,n._)("p",{class:"help-text"}," Offset from the video, if recording started too late. It will be set automatically based on how long the chat dump is and the video length, remember to set it to 0 if you want it that way. ",-1),$e={class:"option-group"},Ve=(0,n._)("div",{class:"option-title"},"Chat location",-1),Ae={class:"option-content"},Ne=(0,n.Uk)(" Overlay"),Re=(0,n.Uk)(" Ultrawide"),Fe=(0,n.Uk)(" Chat align: "),je=(0,n.Uk)(" Left"),qe=(0,n.Uk)(" Right"),ze=(0,n.Uk)(" Text align: "),Be=(0,n.Uk)(" Left"),Me=(0,n.Uk)(" Right"),He=(0,n._)("hr",null,null,-1),Ye=(0,n.Uk)(" Top"),We=(0,n.Uk)(" Bottom"),Qe=(0,n.Uk)(" Width"),Ke={class:"option-group"},Ge=(0,n._)("div",{class:"option-title"},"Chat style",-1),Je={class:"option-content"},Xe=(0,n._)("option",{value:"has-gradient"},"Gradient",-1),et=(0,n._)("option",{value:"has-fill40"},"Fill 40%",-1),tt=(0,n._)("option",{value:"has-fill80"},"Fill 80%",-1),st=(0,n._)("option",{value:""},"None",-1),it=[Xe,et,tt,st],nt=["value"],ot=(0,n.Uk)(" Stroke + shadow"),at=(0,n.Uk)(" Emotes"),lt=(0,n.Uk)(" Timestamps"),rt=(0,n.Uk)(" Badges"),ht=(0,n.Uk)(" Small emotes"),ct=(0,n.Uk)(" VOD comments"),dt=(0,n.Uk)(" Font size"),ut={class:"option-group"},mt={class:"option-content"},pt=(0,n._)("span",null," Nothing is uploaded, everything runs in your browser. ",-1);function vt(e,t,s,d,f,b){const _=(0,n.up)("ChatMessage"),w=(0,n.up)("video-controls");return e.vp?((0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("div",{id:"viewer",class:(0,o.C_)({"viewer-container":!0,ultrawide:e.vp.settings.ultrawide})},[(0,n._)("div",l,[(0,n.wy)((0,n._)("div",r,null,512),[[i.F8,e.vp.videoLoaded]]),e.vp.videoLoaded?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",h,[e.vp.videoLoaded?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",c,u))])),e.vp.settings.chatOverlay?((0,n.wg)(),(0,n.iD)("div",{key:1,id:"comments",class:(0,o.C_)(e.commentsClass),style:(0,o.j5)(e.commentsStyle)},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.vp.commentQueue,(t=>((0,n.wg)(),(0,n.j4)(_,{message:t,vp:e.vp,key:t.gid,"data-id":t.gid},null,8,["message","vp","data-id"])))),128))],6)):(0,n.kq)("",!0),m],512),e.vp.settings.chatOverlay?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",{key:0,id:"comments",class:(0,o.C_)(e.commentsClass),style:(0,o.j5)(e.commentsStyle)},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.vp.commentQueue,(t=>((0,n.wg)(),(0,n.j4)(_,{message:t,vp:e.vp,key:t.gid,"data-id":t.gid},null,8,["message","vp","data-id"])))),128))],6)),e.vp.minimal?((0,n.wg)(),(0,n.j4)(w,{key:1,minimal:!0,vp:e.vp},null,8,["vp"])):(0,n.kq)("",!0)],2),e.vp.minimal?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(w,{key:0,vp:e.vp},null,8,["vp"])),e.vp.minimal?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",p,[(0,n._)("div",v,[e.vp.automated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",{key:0,class:(0,o.C_)([{"option-group":!0,ok:e.vp.videoLoaded},"option-group"])},[g,(0,n._)("div",y,[(0,n.wy)((0,n._)("select",{class:"fullsize","onUpdate:modelValue":t[0]||(t[0]=t=>e.video_source=t)},k,512),[[i.bM,e.video_source]]),C,"file"==e.video_source?((0,n.wg)(),(0,n.iD)("div",T,[(0,n._)("div",P,[(0,n._)("label",null,[(0,n._)("input",L,null,512)])])])):(0,n.kq)("",!0),"file_http"==e.video_source?((0,n.wg)(),(0,n.iD)("div",S,[(0,n._)("div",E,[(0,n._)("label",null,[(0,n._)("input",x,null,512)])])])):(0,n.kq)("",!0),"youtube"==e.video_source?((0,n.wg)(),(0,n.iD)("div",O,[(0,n._)("div",D,[(0,n._)("label",null,[(0,n._)("input",U,null,512)])])])):(0,n.kq)("",!0),"twitch"==e.video_source?((0,n.wg)(),(0,n.iD)("div",I,[(0,n._)("div",Z,[(0,n._)("label",null,[(0,n._)("input",$,null,512)])]),V])):(0,n.kq)("",!0),A,(0,n._)("button",{class:"button is-submit",onClick:t[1]||(t[1]=(...t)=>e.submitVideo&&e.submitVideo(...t))},"Submit")])],2)),e.vp.automated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",{key:1,class:(0,o.C_)([{"option-group":!0,ok:e.vp.chatLoaded},"option-group"])},[N,(0,n._)("div",R,[(0,n.wy)((0,n._)("select",{class:"fullsize","onUpdate:modelValue":t[2]||(t[2]=t=>e.chat_source=t)},z,512),[[i.bM,e.chat_source]]),B,"file"==e.chat_source?((0,n.wg)(),(0,n.iD)("div",M,[(0,n._)("div",H,[(0,n._)("label",null,[(0,n._)("input",Y,null,512)])])])):(0,n.kq)("",!0),"file_http"==e.chat_source?((0,n.wg)(),(0,n.iD)("div",W,[(0,n._)("div",Q,[(0,n._)("label",null,[(0,n._)("input",K,null,512)])])])):(0,n.kq)("",!0),"twitch"==e.chat_source?((0,n.wg)(),(0,n.iD)("div",G,[(0,n._)("div",J,[(0,n._)("label",null,[(0,n._)("input",X,null,512)])])])):(0,n.kq)("",!0),ee,(0,n._)("button",{class:"button is-submit",onClick:t[3]||(t[3]=(...t)=>e.submitChat&&e.submitChat(...t))},"Submit"),te])],2)),e.twitchApiRequired?((0,n.wg)(),(0,n.iD)("div",se,[ie,(0,n._)("div",ne,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"password",placeholder:"Client ID","onUpdate:modelValue":t[4]||(t[4]=t=>e.vp.settings.twitchClientId=t)},null,512),[[i.nr,e.vp.settings.twitchClientId]]),oe]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"password",placeholder:"Secret","onUpdate:modelValue":t[5]||(t[5]=t=>e.vp.settings.twitchSecret=t)},null,512),[[i.nr,e.vp.settings.twitchSecret]]),ae]),le,(0,n._)("span",re,(0,o.zw)(e.vp.settings.twitchToken?"Has token":"No token"),1),he,(0,n._)("button",{class:"button",onClick:t[6]||(t[6]=(...t)=>e.saveSettings&&e.saveSettings(...t))},"Save"),(0,n._)("button",{class:"button",onClick:t[7]||(t[7]=(...t)=>e.fetchTwitchToken&&e.fetchTwitchToken(...t))},"Fetch Twitch token")])])):(0,n.kq)("",!0),(0,n._)("div",ce,[de,(0,n._)("div",ue,[me,pe,(0,n._)("span",null,(0,o.zw)(e.vp.status_video),1),ve,ge,ye,(0,n._)("span",null,(0,o.zw)(e.vp.status_comments),1),fe,be,_e,(0,n._)("span",null,(0,o.zw)(e.vp.emotes.ffz.status),1),we,ke,Ce,(0,n._)("span",null,(0,o.zw)(e.vp.emotes.bttv_channel.status),1),Te,Pe,Le,(0,n._)("span",null,(0,o.zw)(e.vp.emotes.bttv_global.status),1),Se,Ee,xe,(0,n._)("span",null,(0,o.zw)(e.vp.emotes.seventv.status),1)])])]),(0,n._)("div",Oe,[e.vp.automated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",De,[Ue,(0,n._)("div",Ie,[Ze,(0,n.wy)((0,n._)("input",{name:"chatOffset","onUpdate:modelValue":t[8]||(t[8]=t=>e.vp.chatOffset=t)},null,512),[[i.nr,e.vp.chatOffset]])])])),(0,n._)("div",$e,[Ve,(0,n._)("div",Ae,[(0,n._)("div",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",name:"comments-overlay","onUpdate:modelValue":t[9]||(t[9]=t=>e.vp.settings.chatOverlay=t)},null,512),[[i.e8,e.vp.settings.chatOverlay]]),Ne]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",name:"ultrawide","onUpdate:modelValue":t[10]||(t[10]=t=>e.vp.settings.ultrawide=t)},null,512),[[i.e8,e.vp.settings.ultrawide]]),Re])]),(0,n._)("div",null,[Fe,(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"radio",name:"comments-align","onUpdate:modelValue":t[11]||(t[11]=t=>e.vp.settings.chatAlign=t)},null,512),[[i.G2,e.vp.settings.chatAlign]]),je]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"radio",name:"comments-align","onUpdate:modelValue":t[12]||(t[12]=t=>e.vp.settings.chatAlign=t)},null,512),[[i.G2,e.vp.settings.chatAlign]]),qe])]),(0,n._)("div",null,[ze,(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"radio",name:"comments-textalign","onUpdate:modelValue":t[13]||(t[13]=t=>e.vp.settings.chatTextAlign=t)},null,512),[[i.G2,e.vp.settings.chatTextAlign]]),Be]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"radio",name:"comments-textalign","onUpdate:modelValue":t[14]||(t[14]=t=>e.vp.settings.chatTextAlign=t)},null,512),[[i.G2,e.vp.settings.chatTextAlign]]),Me])]),He,(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"input-range",type:"range",min:"0",max:"100","onUpdate:modelValue":t[15]||(t[15]=t=>e.vp.settings.chatTop=t)},null,512),[[i.nr,e.vp.settings.chatTop]]),Ye]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"input-range",type:"range",min:"0",max:"100","onUpdate:modelValue":t[16]||(t[16]=t=>e.vp.settings.chatBottom=t),style:{direction:"ltr"}},null,512),[[i.nr,e.vp.settings.chatBottom]]),We]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"input-range",type:"range",min:"0",max:"100","onUpdate:modelValue":t[17]||(t[17]=t=>e.vp.settings.chatWidth=t)},null,512),[[i.nr,e.vp.settings.chatWidth]]),Qe])])]),(0,n._)("div",Ke,[Ge,(0,n._)("div",Je,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[18]||(t[18]=t=>e.vp.settings.chatStyle=t)},it,512),[[i.bM,e.vp.settings.chatStyle]]),(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[19]||(t[19]=t=>e.vp.settings.fontName=t)},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.vp.fonts,((e,t)=>((0,n.wg)(),(0,n.iD)("option",{key:t,value:t,style:(0,o.j5)({fontFamily:t})},(0,o.zw)(e),13,nt)))),128))],512),[[i.bM,e.vp.settings.fontName]]),(0,n._)("table",null,[(0,n._)("tr",null,[(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[20]||(t[20]=t=>e.vp.settings.chatStroke=t)},null,512),[[i.e8,e.vp.settings.chatStroke]]),ot])]),(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[21]||(t[21]=t=>e.vp.settings.emotesEnabled=t)},null,512),[[i.e8,e.vp.settings.emotesEnabled]]),at])])]),(0,n._)("tr",null,[(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[22]||(t[22]=t=>e.vp.settings.timestampsEnabled=t)},null,512),[[i.e8,e.vp.settings.timestampsEnabled]]),lt])]),(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[23]||(t[23]=t=>e.vp.settings.badgesEnabled=t)},null,512),[[i.e8,e.vp.settings.badgesEnabled]]),rt])])]),(0,n._)("tr",null,[(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[24]||(t[24]=t=>e.vp.settings.smallEmotes=t)},null,512),[[i.e8,e.vp.settings.smallEmotes]]),ht])]),(0,n._)("td",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",checked:"checked","onUpdate:modelValue":t[25]||(t[25]=t=>e.vp.settings.showVODComments=t)},null,512),[[i.e8,e.vp.settings.showVODComments]]),ct])])])]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"range",min:"10",max:"42","onUpdate:modelValue":t[26]||(t[26]=t=>e.vp.settings.fontSize=t)},null,512),[[i.nr,e.vp.settings.fontSize]]),dt])])])]),(0,n._)("div",ut,[(0,n._)("div",mt,[(0,n._)("button",{class:"button",onClick:t[27]||(t[27]=(...t)=>e.apply&&e.apply(...t))},"Apply timings"),(0,n._)("button",{class:"button",onClick:t[28]||(t[28]=(...t)=>e.saveSettings&&e.saveSettings(...t))},"Save settings"),(0,n._)("button",{class:"button",onClick:t[29]||(t[29]=(...t)=>e.resetSettings&&e.resetSettings(...t))},"Reset settings"),(0,n._)("button",{class:"button",onClick:t[30]||(t[30]=(...t)=>e.generateLink&&e.generateLink(...t))},"Generate link"),null!=e.vp?((0,n.wg)(),(0,n.iD)("button",{key:0,class:"button",onClick:t[31]||(t[31]=t=>e.vp?e.vp.minimal=!0:"")},"Minimal mode")):(0,n.kq)("",!0),pt])])]))],512)):(0,n.kq)("",!0)}const gt={key:0,class:"comment"},yt={key:0,class:"time"},ft={key:1,class:"badges"},bt={class:"body"},_t={key:0},wt={key:2};function kt(e,t,s,i,a,l){const r=(0,n.up)("ChatBadge"),h=(0,n.up)("ChatEmote");return s.vp&&s.message?((0,n.wg)(),(0,n.iD)("div",gt,[s.vp.settings.timestampsEnabled?((0,n.wg)(),(0,n.iD)("span",yt,(0,o.zw)(s.message.time),1)):(0,n.kq)("",!0),s.vp.settings.badgesEnabled?((0,n.wg)(),(0,n.iD)("span",ft,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.message.badges,((e,t)=>((0,n.wg)(),(0,n.j4)(r,{key:t,badge:e,vp:s.vp},null,8,["badge","vp"])))),128))])):(0,n.kq)("",!0),(0,n._)("span",{class:"name",style:(0,o.j5)({color:s.message.usernameColour})},(0,o.zw)(s.message.username)+":",5),(0,n._)("span",bt,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.message.messageFragments,((e,t)=>((0,n.wg)(),(0,n.iD)("span",{key:t},["text"==e.type?((0,n.wg)(),(0,n.iD)("span",_t,(0,o.zw)(e.data),1)):(0,n.kq)("",!0),"emote"==e.type&&s.vp.settings.emotesEnabled?((0,n.wg)(),(0,n.j4)(h,{key:1,emote:e.data,vp:s.vp},null,8,["emote","vp"])):(0,n.kq)("",!0),"emote"!=e.type||s.vp.settings.emotesEnabled?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",wt,(0,o.zw)(e.data.name),1))])))),128))])])):(0,n.kq)("",!0)}const Ct=["src"];function Tt(e,t,s,i,a,l){return e.emote?((0,n.wg)(),(0,n.iD)("img",{key:0,class:(0,o.C_)(e.classObject),src:e.emote.url},null,10,Ct)):(0,n.kq)("",!0)}var Pt=(0,n.aZ)({name:"ChatEmote",props:{vp:Object,emote:Object},computed:{classObject(){if(!this.emote||!this.vp)return null;let e={emote:!0,["network-"+this.emote.network]:!0,"is-small":this.vp.settings.smallEmotes};return void 0!==this.emote.class&&(e[this.emote.class]=!0),e}}}),Lt=s(89);const St=(0,Lt.Z)(Pt,[["render",Tt]]);var Et=St;const xt=["src"];function Ot(e,t,s,i,o,a){return e.badge?((0,n.wg)(),(0,n.iD)("img",{key:0,class:"badge",src:e.badge.url},null,8,xt)):(0,n.kq)("",!0)}var Dt=(0,n.aZ)({name:"ChatBadge",props:{badge:Object}});const Ut=(0,Lt.Z)(Dt,[["render",Ot]]);var It=Ut,Zt={name:"ChatMessage",components:{ChatEmote:Et,ChatBadge:It},props:{vp:Object,message:Object}};const $t=(0,Lt.Z)(Zt,[["render",kt]]);var Vt=$t;const At={class:"video-controls-buttons"},Nt={key:0,class:"video-controls-buttons-group"},Rt={key:1,class:"video-controls-buttons-group"},Ft={key:2,class:"video-controls-buttons-group"},jt=(0,n.Uk)(" Overlay"),qt=(0,n.Uk)(" Ultrawide"),zt=(0,n.Uk)(" Minimal");function Bt(e,t,s,a,l,r){return e.vp?((0,n.wg)(),(0,n.iD)("div",{key:0,class:(0,o.C_)({"video-controls":!0,minimal:e.minimal})},[(0,n._)("div",{id:"timeline",ref:"timeline",onClick:t[0]||(t[0]=(...t)=>e.seek&&e.seek(...t))},[(0,n._)("div",{id:"timeline-seekbar",ref:"seekbar",style:(0,o.j5)({width:100*e.vp.videoPosition+"%"})},null,4)],512),(0,n._)("div",At,[e.vp.isReady?((0,n.wg)(),(0,n.iD)("div",Rt,[(0,n._)("button",{class:"pb-button",onClick:t[2]||(t[2]=(...t)=>e.togglePause&&e.togglePause(...t))},(0,o.zw)(e.vp?.embedPlayer?.isPaused?"▶":"⏸"),1),(0,n._)("button",{class:"pb-button",onClick:t[3]||(t[3]=(...t)=>e.fullscreen&&e.fullscreen(...t))},"Fullscreen"),(0,n._)("button",{class:"pb-button",onClick:t[4]||(t[4]=(...t)=>e.resetChat&&e.resetChat(...t))},"Reset chat")])):((0,n.wg)(),(0,n.iD)("div",Nt,[e.vp.isPlaying?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("button",{key:0,class:"pb-button is-submit",onClick:t[1]||(t[1]=(...t)=>e.startPlayback&&e.startPlayback(...t))},"Start playback"))])),e.vp.minimal?((0,n.wg)(),(0,n.iD)("div",Ft,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",name:"comments-overlay","onUpdate:modelValue":t[5]||(t[5]=t=>e.vp.settings.chatOverlay=t)},null,512),[[i.e8,e.vp.settings.chatOverlay]]),jt]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",name:"ultrawide","onUpdate:modelValue":t[6]||(t[6]=t=>e.vp.settings.ultrawide=t)},null,512),[[i.e8,e.vp.settings.ultrawide]]),qt]),(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{type:"checkbox",name:"minimal","onUpdate:modelValue":t[7]||(t[7]=t=>e.vp.minimal=t)},null,512),[[i.e8,e.vp.minimal]]),zt])])):(0,n.kq)("",!0)])],2)):(0,n.kq)("",!0)}var Mt=(0,n.aZ)({name:"VideoControls",props:{vp:Object,minimal:Boolean},mounted(){},methods:{fullscreen(){this.vp&&this.vp.fullscreen()},seek(e){if(!this.vp)return;if(!this.vp.embedPlayer)return console.error("trying to seek from gui with no embed player"),!1;const t=this.$refs.timeline;let s=this.vp.embedPlayer.getDuration()||0,i=t.getBoundingClientRect(),n=(e.clientX-i.left)/t.clientWidth,o=Math.round(s*n);this.vp.seek(o)},startPlayback(){this.vp&&this.vp.startPlayback()},togglePause(){this.vp&&this.vp.togglePause()},resetChat(){this.vp&&this.vp.reset()}}});const Ht=(0,Lt.Z)(Mt,[["render",Bt]]);var Yt=Ht,Wt=s(482);class Qt{constructor(){(0,Wt.Z)(this,"vodplayer",void 0),(0,Wt.Z)(this,"manualPause",void 0),(0,Wt.Z)(this,"listeners",void 0),this.vodplayer=null,this.manualPause=!1,this.listeners={}}emit(e,t){const s=this.listeners[e];"function"===typeof s&&s(t)}addEventListener(e,t){this.listeners[e]=t}removeEventListener(e){delete this.listeners[e]}html(){return""}setup(){const e=document.getElementById("video_container");e&&(e.innerHTML=this.html(),console.log("Set up embed player"))}play(){alert("no play implemented")}pause(){return alert("no pause implemented"),!1}seek(e){alert(`no seek implemented (${e})`)}getDuration(){return alert("no duration implemented"),0}getCurrentTime(){return alert("no current time implemented"),0}callPause(e){console.log("call pause",e),this.manualPause=e}setStatusText(e){this.vodplayer&&(this.vodplayer.status_video=e)}get isPaused(){return!1}}class Kt extends Qt{constructor(e){super(),(0,Wt.Z)(this,"player",void 0),(0,Wt.Z)(this,"video_path",void 0),(0,Wt.Z)(this,"isReady",void 0),this.player=null,this.video_path=e,this.isReady=!1}setup(){if(this.setStatusText("Set up HTML5 video player..."),!this.vodplayer)return console.error("No vodplayer assigned"),!1;this.player=document.createElement("video");const e=document.getElementById("video_container");if(!e)return console.error("No video container (html5)"),!1;e.appendChild(this.player),this.player.src=this.video_path,this.player.width=1280,this.player.height=720,this.manualPause=this.player.paused,this.player.addEventListener("canplay",(()=>{!this.isReady&&this.vodplayer&&(console.log("html5 video player ready"),this.setStatusText("HTML5 video player ready!"),this.vodplayer.videoLoaded=!0,this.emit("ready",!0),this.isReady=!0)})),this.player.addEventListener("play",(()=>{this.callPause(!1),this.emit("play",!0)})),this.player.addEventListener("pause",(()=>{this.callPause(!0),this.emit("pause",!0)})),this.player.addEventListener("seeked",(e=>{console.debug("html5 player seeked",e),this.emit("seeked",this.getCurrentTime())}))}play(){this.player&&this.player.play()}pause(){return!!this.player&&(this.player.pause(),!0)}seek(e){this.player&&(this.player.currentTime=e)}getDuration(){return this.player?this.player.duration:0}getCurrentTime(){return this.player?this.player.currentTime:0}get isPaused(){return!!this.player&&this.player.paused}}class Gt extends Qt{constructor(e){super(),(0,Wt.Z)(this,"vod_id",void 0),(0,Wt.Z)(this,"player",null),this.vod_id=e}setup(){const e=document.createElement("div"),t=document.getElementById("video_container");if(!t)return console.error("No video container (twitch)"),!1;t.appendChild(e),this.setStatusText("Set up Twitch embed player..."),this.player=new window.Twitch.Player(e,{width:"100%",height:"100%",video:this.vod_id,autoplay:!1,controls:!1}),console.log("Embed player created",this.player),console.log("Add event listeners"),this.player.addEventListener(window.Twitch.Player.READY,(()=>{this.vodplayer&&this.player&&(console.log("embed player ready"),this.setStatusText("Embed Twitch player ready!"),this.player.seek(0),this.player.pause(),this.player.setMuted(!1),setTimeout((()=>{this.player&&(this.player.seek(0),this.player.pause())}),500),this.vodplayer.videoLoaded=!0,this.emit("ready",!0))})),this.player.addEventListener(window.Twitch.Player.PLAY,(()=>{if(this.vodplayer){if(console.log("embed player play"),!this.vodplayer.isPlaying&&this.player)return console.log("oops, player started without user wanting it"),this.player.seek(0),void this.player.pause();this.callPause(!1),this.emit("play",!0)}})),this.player.addEventListener(window.Twitch.Player.PAUSE,(()=>{this.callPause(!0),this.emit("pause",!0)}))}play(){this.player&&this.player.play()}pause(){return!!this.player&&(this.player.pause(),!0)}seek(e){this.player&&this.player.seek(e)}getDuration(){return this.player?this.player.getDuration():null}getCurrentTime(){return this.player?this.player.getCurrentTime():null}get isPaused(){return!!this.player&&this.player.isPaused()}}class Jt extends Qt{constructor(e){super(),(0,Wt.Z)(this,"youtube_id",void 0),(0,Wt.Z)(this,"player",void 0),(0,Wt.Z)(this,"YT_PLAY",1),(0,Wt.Z)(this,"YT_PAUSE",2),(0,Wt.Z)(this,"isReady",void 0),this.youtube_id=e,this.player=null,this.isReady=!1,console.log(`Created YouTube player with id ${e}`)}setup(){this.setStatusText("Set up YouTube player...");const e=e=>{this.vodplayer&&(this.setStatusText("YouTube Player ready!"),console.log("youtube player ready",e),this.isReady=!0,this.vodplayer.videoLoaded=!0,this.emit("ready",!0))},t=e=>{console.log("youtube player state change",e),e==this.YT_PAUSE?(this.callPause(!0),this.emit("pause",!0)):e==this.YT_PLAY&&(this.callPause(!0),this.emit("play",!0))},s=e=>{console.log("youtube player error",e)};console.log("Create player div");const i=document.createElement("div"),n=document.getElementById("video_container");if(!n)return console.error("No video container (youtube)"),!1;n.appendChild(i),console.log("Access YouTube API"),this.player=null,this.player=new window.YT.Player(i,{width:"1280",height:"720",videoId:this.youtube_id,events:{onReady:e,onStateChange:t,onError:s}})}play(){this.player&&this.player.playVideo()}pause(){return!!this.player&&(this.player.pauseVideo(),!0)}seek(e){this.player&&this.player.seekTo(e,!1)}getDuration(){return this.isReady&&this.player?this.player.getDuration():null}getCurrentTime(){return this.isReady&&this.player?this.player.getCurrentTime():null}get isPaused(){if(this.isReady&&this.player)return 2==this.player.getPlayerState()}}class Xt{constructor(){(0,Wt.Z)(this,"channelId",void 0),(0,Wt.Z)(this,"emotes",void 0),(0,Wt.Z)(this,"status","Waiting...")}fetchEmotes(e){throw console.debug(e),"Not implemented"}getEmotes(){return this.emotes}parseComment(e,t){throw console.debug(e,t),"Not implemented"}}class es extends Xt{async fetchEmotes(e){console.log("Fetching FFZ");const t=await fetch(`https://api.frankerfacez.com/v1/room/id/${e}`),s=await t.json();if(!s.sets)return console.error("failed to load ffz",s),void(this.status="Failed to load");this.emotes=s,console.log("ffz",this.emotes);const i=Object.values(this.emotes.sets).reduce(((e,t)=>e+Object.keys(t.emoticons).length),0);this.status=`OK! (${Object.keys(this.emotes.sets).length} sets, ${i} emotes)`}parseComment(e,t){if(!this.emotes)return!1;for(const s in this.emotes.sets)for(const i of this.emotes.sets[s].emoticons)if(i.name==e)return t.messageFragments.push({type:"emote",data:{network:"ffz",name:e,url:"https:"+i.urls[1]}}),!0;return!1}}class ts extends Xt{async fetchEmotes(e){console.log("Fetching BTTV Global",e);const t=await fetch("https://api.betterttv.net/3/cached/emotes/global"),s=await t.json();if(!s||0==s.length)return console.error("failed to load bttvglobal",s),void(this.status="Failed to load");this.emotes=s,console.log("bttvglobal",this.emotes),this.status=`OK! (${this.emotes.length} emotes)`}parseComment(e,t){if(!this.emotes)return!1;for(const s of this.emotes)if(s.code==e)return t.messageFragments.push({type:"emote",data:{network:"bttv_global",class:"bttv-emo-"+s.id,name:e,url:`https://cdn.betterttv.net/emote/${s.id}/2x`}}),!0;return!1}}class ss extends Xt{async fetchEmotes(e){console.log("Fetching BTTV Channel");const t=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${e}`),s=await t.json();if(!s||0==s.channelEmotes.length)return console.error("failed to load bttvchannel",s),void(this.status="Failed to load");this.emotes=s,console.log("bttvchannel",this.emotes),this.status=`OK! (${this.emotes.channelEmotes.length} channel, ${this.emotes.sharedEmotes.length} shared)`}parseComment(e,t){if(!this.emotes)return!1;if(this.emotes.sharedEmotes)for(const s of this.emotes.sharedEmotes)if(s.code==e)return t.messageFragments.push({type:"emote",data:{network:"bttv_channel",class:"bttv-emo-"+s.id,name:e,url:`https://cdn.betterttv.net/emote/${s.id}/2x`}}),!0;if(this.emotes.channelEmotes)for(const s of this.emotes.channelEmotes)if(s.code==e)return t.messageFragments.push({type:"emote",data:{network:"bttv_channel",class:"bttv-emo-"+s.id,name:e,url:`https://cdn.betterttv.net/emote/${s.id}/2x`}}),!0;return!1}}class is extends Xt{async fetchEmotes(e){console.log("Fetching seventv");const t=await fetch(`https://api.7tv.app/v2/users/${e}/emotes`),s=await t.json();return"message"in s?(console.error("failed to load seventv",s),this.status=`Error: ${s.message}`,!1):s.length<=0?(console.error("failed to load seventv, no data",s),this.status="No emotes",!1):(this.emotes=s,console.log("seventv",this.emotes),this.status=`OK! (${this.emotes.length} emotes)`,!0)}parseComment(e,t){if(!this.emotes)return!1;for(const s of this.emotes)if(s.name==e){if(!s.urls||0==s.urls.length){console.error("no urls on seventv emote",s);continue}if(!s.urls[0]||!s.urls[0][1]){console.error("invalid url on seventv emote",s);continue}return t.messageFragments.push({type:"emote",data:{network:"seventv",name:e,url:s.urls[0][1]}}),!0}return!1}}let ns;const os={twitchClientId:"",twitchSecret:"",twitchToken:"",emotesEnabled:!0,timestampsEnabled:!1,badgesEnabled:!0,smallEmotes:!1,showVODComments:!1,chatTop:0,chatBottom:0,chatWidth:25,chatStroke:!0,chatStyle:"has-gradient",chatAlign:"left",chatTextAlign:"left",chatOverlay:!0,fontSize:12,fontName:"Inter",ultrawide:!1};class as{constructor(){(0,Wt.Z)(this,"chatLog",void 0),(0,Wt.Z)(this,"baseTitle","braxen's vod replay"),(0,Wt.Z)(this,"fonts",{Inter:"Inter (Twitch)",Arial:"Arial",Helvetica:"Helvetica",Raleway:"Raleway",Hack:"Hack","Open Sans":"Open Sans",Roboto:"Roboto","Segoe UI":"Segoe UI",Verdana:"Verdana",Consolas:"Consolas","Lucida Console":"Lucida Console",monospace:"monospace"}),(0,Wt.Z)(this,"emotes",void 0),(0,Wt.Z)(this,"badges",void 0),(0,Wt.Z)(this,"elements",void 0),(0,Wt.Z)(this,"timeStart",void 0),(0,Wt.Z)(this,"chatOffset",void 0),(0,Wt.Z)(this,"commentAmount",void 0),(0,Wt.Z)(this,"tickDelay",void 0),(0,Wt.Z)(this,"vodLength",void 0),(0,Wt.Z)(this,"archiveLength",void 0),(0,Wt.Z)(this,"channelName",void 0),(0,Wt.Z)(this,"noVideo",void 0),(0,Wt.Z)(this,"isPlaying",void 0),(0,Wt.Z)(this,"isReady",void 0),(0,Wt.Z)(this,"automated",void 0),(0,Wt.Z)(this,"twitchClientId",void 0),(0,Wt.Z)(this,"channelId",""),(0,Wt.Z)(this,"videoId",""),(0,Wt.Z)(this,"videoTitle",""),(0,Wt.Z)(this,"videoChapters",void 0),(0,Wt.Z)(this,"interval",void 0),(0,Wt.Z)(this,"embedPlayer",null),(0,Wt.Z)(this,"videoLoaded",void 0),(0,Wt.Z)(this,"chatLoaded",void 0),(0,Wt.Z)(this,"commentQueue",void 0),(0,Wt.Z)(this,"commentLimit",void 0),(0,Wt.Z)(this,"chatlog_version",null),(0,Wt.Z)(this,"fetchChatRunning",!1),(0,Wt.Z)(this,"settings",{...os}),(0,Wt.Z)(this,"lastCommentTime",null),(0,Wt.Z)(this,"lastCommentOffset",null),(0,Wt.Z)(this,"status_video","Waiting..."),(0,Wt.Z)(this,"status_comments","Waiting..."),(0,Wt.Z)(this,"status_ffz","Waiting..."),(0,Wt.Z)(this,"status_bttv_channel","Waiting..."),(0,Wt.Z)(this,"status_bttv_global","Waiting..."),(0,Wt.Z)(this,"status_seventv","Waiting..."),(0,Wt.Z)(this,"playback_text","Waiting..."),(0,Wt.Z)(this,"chat_source",null),(0,Wt.Z)(this,"video_source",null),(0,Wt.Z)(this,"video_id",""),(0,Wt.Z)(this,"chat_id",""),(0,Wt.Z)(this,"allCommentsFetched",!1),(0,Wt.Z)(this,"malformed_comments",void 0),(0,Wt.Z)(this,"minimal",!1),this.chatLog=null,this.automated=!1,this.emotes={ffz:new es,bttv_channel:new ss,bttv_global:new ts,seventv:new is},this.badges={global:{},channel:{}},this.embedPlayer=null,this.resetSettings(),this.videoChapters=[],this.timeStart=null,this.chatOffset=0,this.videoLoaded=!1,this.chatLoaded=!1,this.commentAmount=null,this.chatlog_version=null,this.commentQueue=[],this.commentQueue.push({time:"00:00:00",username:"braxen",usernameColour:"#ff0000",messageFragments:[{type:"text",data:"welcome to my vod player! select video and chat below to begin!"}]}),this.commentQueue.push({time:"00:00:00",username:"helper",usernameColour:"#ffff00",messageFragments:[{type:"text",data:"word"},{type:"text",data:"spacing"},{type:"text",data:"test"},{type:"text",data:"and"},{type:"text",data:"word"},{type:"text",data:"wrapping"},{type:"text",data:"test"}]}),this.elements={viewer:null,video:null,comments:null,player:null},this.tickDelay=50,this.commentLimit=50,this.vodLength=null,this.archiveLength=null,this.channelName="",this.noVideo=!1,this.isPlaying=!1,this.isReady=!1,this.twitchClientId="",this.interval=null,this.malformed_comments=0}setTitle(e){document.title=`${this.baseTitle} - ${e}`}tick(){if(!this.vodLength)throw"No vod length in tick";if(!this.embedPlayer)throw"No embed player in tick";const e=this.embedPlayer.getCurrentTime(),t=(this.embedPlayer.getCurrentTime()??0)+this.chatOffset;if(null===e)return!1;if(e>=this.vodLength)return this.pause(),!1;0==ns.comments.length&&console.error("No comments to display");for(let s=0;s<ns.comments.length;s++){const e=ns.comments[s];if(void 0===e.content_offset_seconds||e.content_offset_seconds<0){if(console.error("Malformed comment",e),this.malformed_comments++,this.malformed_comments>100)return this.pause(),alert("Too many malformed comments, something is wrong with the chat log."),!1;continue}if(e.displayed)continue;if(this.settings.showVODComments&&e.source&&"comment"==e.source){this.debug(`skip comment, vod comment: ${s}`);continue}if(t<e.content_offset_seconds)continue;const i=t-e.content_offset_seconds;if(i>60&&!e.displayed){e.displayed=!0;continue}if(ns.comments[s+1]&&ns.comments[s+1].content_offset_seconds>e.content_offset_seconds+600)return this.pause(),alert("Next comment is over 10 minutes in the future, something is probably wrong with the file."),!1;const n={};if(e._id||console.warn(`No id on comment #${s} @ (${e.content_offset_seconds})`),n.gid=e._id??`tmp${s}`,n.time=this.timeFormat(e.content_offset_seconds),n.badges=[],e.message.user_badges&&this.badges.global&&this.badges.channel)for(const t of e.message.user_badges){const e=t._id,s=t.version;let i=null;if(this.badges.global[e]&&this.badges.global[e].versions[s]&&(i=this.badges.global[e].versions[s].image_url_1x),this.badges.channel[e]&&this.badges.channel[e].versions[s]&&(i=this.badges.channel[e].versions[s].image_url_1x),!i){console.error("no badge",e,s);continue}const o={id:t._id,url:i};n.badges.unshift(o)}n.username=e.commenter.display_name,n.usernameColour=e.message.user_color,n.messageFragments=[];for(const t of e.message.fragments)if(t.emoticon&&this.settings.emotesEnabled)n.messageFragments.push({type:"emote",data:{network:"twitch",url:`https://static-cdn.jtvnw.net/emoticons/v1/${t.emoticon.emoticon_id}/1.0`}});else{const e=t.text.split(" ");for(const t of e){let e=!1;for(const s in this.emotes)this.emotes[s].parseComment(t,n)&&(e=!0);e||n.messageFragments.push({type:"text",data:t})}}this.commentQueue.push(n),e.displayed=!0}return this.elements.comments&&(this.elements.comments.scrollTop=this.elements.comments.scrollHeight),this.commentQueue.length>=this.commentLimit&&this.commentQueue.splice(0,this.commentQueue.length-this.commentLimit),!0}createLegacyCommentElement(e){console.debug("Create legacy comment",e);const t=document.createElement("div");if(t.className="comment",this.settings.timestampsEnabled){const s=this.timeFormat(e.content_offset_seconds),i=document.createElement("span");i.className="time",i.innerHTML=`[${s}]`,t.appendChild(i)}const s=document.createElement("span");s.className="badges";for(const o of e.badges){const e=document.createElement("img");e.className="badge "+o.id,e.src=o.url,s.appendChild(e)}t.appendChild(s);const i=document.createElement("span");i.className="name",i.innerHTML=e.username+":",i.style.color=e.usernameColour,t.appendChild(i);const n=document.createElement("span");n.className="body";for(const o of e.messageFragments)if("text"==o.type){const e=document.createElement("span");e.className="text",e.innerHTML=o.data,n.appendChild(e)}else if("emote"==o.type&&"string"!=typeof o.data){const e=document.createElement("img");e.className="emote",e.src=o.data.url||"",n.appendChild(e)}return t.appendChild(n),t}startPlayback(){if(this.isPlaying)return alert("Already playing"),!1;if(console.debug("Started playback"),!this.chatLoaded&&!this.videoLoaded)return alert("Neither chat nor video loaded, please do that first!"),!1;if(!this.chatLoaded)return alert("No chat log added"),!1;if(!this.embedPlayer)return alert("No embed player has been created, can't play."),!1;this.embedPlayer.addEventListener("play",(()=>{console.log("custom event play")})),this.embedPlayer.addEventListener("pause",(()=>{console.log("custom event pause")})),this.embedPlayer.addEventListener("seeked",(e=>{console.log(`custom event seeked: ${e}`)})),this.commentQueue=[],this.timeStart=Date.now(),this.embedPlayer.play();const e=document.getElementById("optionOffset");e&&console.debug(`Offset: ${e.value}`),this.applyTimings(),this.chat_source,this.timeStart+=this.chatOffset,this.play();const t=document.getElementById("buttonStart");return t&&(t.disabled=!0),this.automated,this.isPlaying=!0,this.isReady=!0,!0}play(){this.embedPlayer&&(console.log("Play executed"),this.interval=setInterval(this.tick.bind(this),this.tickDelay),this.embedPlayer.play())}pause(){this.embedPlayer&&(console.log("Pause executed"),this.interval&&clearInterval(this.interval),this.embedPlayer.pause(),this.malformed_comments=0)}togglePause(){this.embedPlayer&&(this.embedPlayer.isPaused?this.play():this.pause())}seek(e){if(!this.vodLength)throw"no vod length when seeking";this.embedPlayer?(this.embedPlayer.seek(e),console.debug("Post seek",this.videoCurrentTime,this.timeStart),this.reset(),this.interval&&(console.debug("Restart interval"),clearInterval(this.interval),this.interval=setInterval(this.tick.bind(this),this.tickDelay)),console.log(`New time start: ${this.timeStart}`)):alert("nothing to seek yet")}reset(){if(console.debug("Reset chat"),console.debug(`Resetting queue, still ${this.commentQueue.length} comments.`),this.commentQueue=[],this.commentAmount){console.debug(`Reset ${this.commentAmount} comments`);for(let e=0;e<this.commentAmount;e++){const t=ns.comments[e];t.displayed=!1}}else console.debug("No comment queue")}applyTimings(){console.debug("Applying options"),console.log(`TickDelay: ${this.tickDelay}`),this.interval&&(console.debug("clear interval"),clearInterval(this.interval),this.interval=setInterval(this.tick.bind(this),this.tickDelay))}parseDuration(e){if(!e)return;const t=e.match(/([0-9]+)h/),s=e.match(/([0-9]+)m/),i=e.match(/([0-9]+)s/),n=t?parseInt(t[1]):0,o=s?parseInt(s[1]):0,a=i?parseInt(i[1]):0;return 60*n*60+60*o+a}fullscreen(){const e=this.elements.viewer;if(!e)return!1;e.requestFullscreen&&e.requestFullscreen()}loadVideo(e,t){if(console.debug("video input",t,t.value,t.files),!t.value&&!t.files)return alert("No video selected"),!1;if(this.video_source=e,t.files){const e=t.files[0];if(!e)return alert("No video selected"),!1;const s=URL.createObjectURL(e);return this.embedPlayer=new Kt(s),this.embedPlayer.vodplayer=this,this.embedPlayer.setup(),this.video_id="",!0}if("file_http"==e)return this.embedPlayer=new Kt(t.value),this.embedPlayer.vodplayer=this,this.embedPlayer.setup(),this.video_id=t.value,!0;if("twitch"==e){const e=t.value.match(/\/videos\/([0-9]+)/);return e?(this.embedPlayer=new Gt(e[1]),this.embedPlayer.vodplayer=this,this.embedPlayer.setup(),this.video_id=e[1],!0):(alert("invalid twitch vod link"),!1)}if("youtube"==e){const e=t.value.match(/v=([A-Za-z0-9]+)/),s=t.value.match(/\.be\/([A-Za-z0-9]+)/);let i;return e&&(i=e[1]),s&&(i=s[1]),i?(this.embedPlayer=new Jt(i),!!this.embedPlayer&&(this.embedPlayer.vodplayer=this,this.embedPlayer.setup(),this.video_id=i,!0)):(alert("invalid youtube link"),!1)}return console.error("unhandled video input"),!1}async loadChat(e,t){if(console.debug("chat input",t,t.value,t.files),!t.value&&!t.files)return alert("No chat selected"),!1;if(this.chat_source=e,t.files){this.debug("load chat file locally");const e=t.files[0];let i;try{i=URL.createObjectURL(e)}catch(s){return alert("Invalid file selected"),!1}const n=await this.loadChatFileFromURL(i);return!!n&&(console.log("loading chat from file success"),this.chat_id="",!0)}if("file_http"==e){this.debug("load chat file from http");const e=await this.loadChatFileFromURL(t.value);return!!e&&(this.chat_id=t.value,!0)}if("twitch"==e){const e=t.value.match(/\/videos\/([0-9]+)/);return e?(this.loadTwitchChat(e[1]),this.chat_id=e[1],!0):(alert("invalid twitch vod link"),!1)}return console.error("unhandled chat input"),!1}async loadChatFileFromURL(e){let t,s;this.status_comments="Loading...",console.debug(`Load chat from url: ${e}`);try{t=await fetch(e)}catch(n){return alert(`HTTP error: ${n}`),console.error("HTTP error",n),this.status_comments="Error!",!1}console.debug("Parse chat json...");try{s=await t.json()}catch(n){return console.error("loadChatFileFromURL json error",n),this.status_comments="Error!",!1}if(console.debug("Returned JSON for chat"),!s.comments)return s.chapters&&s.segments&&s.streamer_name?(alert("Thanks for using TwitchAutomator! Seems like you selected the wrong file though."),console.error("twitchautomator error",s),this.status_comments="Error!",!1):(console.error("loadChatFileFromURL json has no comments",s),this.status_comments="Error!",!1);ns=s,console.debug("Chat JSON stored in memory",ns),this.commentAmount=Object.values(ns.comments).length,console.debug(`Comment amount: ${this.commentAmount}`);const i=ns.video.duration;if(i){this.chatlog_version="twitch_v2";const e=i.match(/([0-9]+)h/),t=i.match(/([0-9]+)m/),s=i.match(/([0-9]+)s/),n=e?parseInt(e[1]):0,o=t?parseInt(t[1]):0,a=s?parseInt(s[1]):0;console.debug("v2 date parse",n,o,a),this.vodLength=60*n*60+60*o+a}else if(ns.video.length)this.vodLength=parseInt(ns.video.length),this.chatlog_version="twitch_v1";else{if(!ns.video.end)return alert("Chat log unsupported, it might be too old."),console.error("Chat log unsupported, it might be too old."),this.status_comments="Error!",!1;this.vodLength=ns.video.end,this.chatlog_version="td_v1"}return console.debug(`VOD length: ${this.vodLength}`),this.embedPlayer?(this.archiveLength=this.embedPlayer.getDuration(),console.debug(`embedPlayer length: ${this.archiveLength}`)):console.error("No embed player to set archive length from"),this.archiveLength&&this.archiveLength>0&&this.vodLength&&(this.chatOffset=this.vodLength-this.archiveLength),"td_v1"==this.chatlog_version?(this.channelName=ns.streamer.name,this.channelId=ns.streamer.id,this.videoId=ns.comments[0].content_id):"twitch_v2"==this.chatlog_version?(this.channelName=ns.video.user_name,this.channelId=ns.video.user_id,this.videoId=ns.video.id,this.videoTitle=ns.video.title,this.setTitle(`${this.channelName}: ${this.videoTitle}`)):(this.channelName=ns.video.channel.display_name,this.channelId=ns.video.channel._id,this.videoId=ns.video._id),this.fetchBadges(),this.fetchEmotes(),this.settings.twitchClientId,this.lastCommentOffset=Math.round(ns.comments[this.commentAmount-1].content_offset_seconds),this.status_comments=`OK (${this.chatlog_version}, ${this.channelName}, ${this.commentAmount}c, ${this.lastCommentOffset}o, ${this.vodLength}s)!`,this.vodLength&&this.vodLength>this.lastCommentOffset+90&&(this.status_comments+=" (end of comments don't sync up)"),this.chatLoaded=!0,!0}async loadTwitchChat(e){return console.debug("load twitch chat",this),this.videoId=e,this.fetchVideoInfo().then((e=>{if(e.error)return alert("VOD loading error: "+e.message),!1;if(!e.data)throw alert("VOD loading error, probably deleted"),"VOD loading error, probably deleted";const t=e.data[0];console.log("loadOnline",t);const s=this.parseDuration(t.duration);return s?(this.vodLength=s,this.channelName=t.user_name,this.channelId=t.user_id,console.log("LoadOnline length",this.vodLength),console.log("LoadOnline channel name",this.channelName),console.log("LoadOnline channel id",this.channelId),this.fetchBadges(),this.fetchEmotes(),this.fetchChat(),this.chatLoaded=!0,!0):(console.error("invalid duration on video info"),!1)}))}async fetchBadges(){return this.channelId?(await fetch("https://badges.twitch.tv/v1/badges/global/display").then((function(e){return e.json()})).then((e=>{e.badge_sets&&(this.badges.global=e.badge_sets,console.debug("twitch badges global",this.badges.global))})),await fetch(`https://badges.twitch.tv/v1/badges/channels/${this.channelId}/display`).then((function(e){return e.json()})).then((e=>{e.badge_sets&&(this.badges.channel=e.badge_sets,console.debug("twitch badges channel",this.badges.channel))})),!0):(console.error("No channel id for badges"),!1)}fetchEmotes(){if(!this.channelName)return console.error("No channel name for emotes"),!1;for(const e in this.emotes)this.emotes[e].fetchEmotes(this.channelId)}async fetchChat(){ns.comments=[];const e=await this.fetchChatFragment(0);if(!e.comments)return console.error("could not fetch comments"),!1;let t=e._next;console.log("first fragment",e),ns.comments=ns.comments.concat(e.comments),this.fetchChatRunning=!0;while(t&&this.fetchChatRunning){const e=await this.fetchChatFragment(null,t);t=e._next,e.comments?(ns.comments=ns.comments.concat(e.comments),console.log("Add messages to chat log",ns.comments.length,e.comments.length),console.log("Message info",e.comments[0].content_offset_seconds,e.comments[0].commenter.display_name),e.comments[e.comments.length-1]?this.lastCommentTime=e.comments[e.comments.length-1].content_offset_seconds:console.error("no comment available"),this.commentAmount=ns.comments.length,this.lastCommentOffset=Math.round(ns.comments[this.commentAmount-1].content_offset_seconds),this.status_comments=`OK (dump, ${this.channelName}, ${this.commentAmount}c, ${this.lastCommentOffset}o, ${this.vodLength}s)!`,this.vodLength&&this.vodLength>this.lastCommentOffset+90&&(this.status_comments+=" (end of comments don't sync up)")):console.error("no comments with cursor")}this.allCommentsFetched=!0,this.status_comments=`OK (dump, ${this.channelName}, ${this.commentAmount}c (complete), ${this.vodLength}s)!`,console.log("Chat fetching stopped")}async fetchChatFragment(e,t=null){let s=`https://api.twitch.tv/kraken/videos/${this.videoId}/comments`;return t&&(s+=`?cursor=${t}`),this.videoCurrentTime&&(s+=(t?"&":"?")+`content_offset_seconds=${this.videoCurrentTime}`),fetch(s,{headers:{"Client-ID":this.settings.twitchClientId,Accept:"application/vnd.twitchtv.v5+json"}}).then((e=>e.json()))}async fetchVideoInfo(){return fetch(`https://api.twitch.tv/helix/videos?id=${this.videoId}`,{headers:{"Client-ID":this.settings.twitchClientId,Authorization:"Bearer "+this.settings.twitchToken}}).then((e=>e.json()))}async fetchTwitchToken(){return this.settings.twitchClientId&&this.settings.twitchSecret?fetch(`https://id.twitch.tv/oauth2/token?client_id=${this.settings.twitchClientId}&client_secret=${this.settings.twitchSecret}&grant_type=client_credentials`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(e.message&&alert(e.message),e.access_token)return this.settings.twitchToken=e.access_token,this.saveSettings(),e.access_token})).catch((e=>(console.error("tac error",e),!1))):(alert("Missing either Twitch client id or secret"),!1)}hooks(){document.body.addEventListener("keyup",(e=>{if(this.isReady&&null!=this.embedPlayer){const t=this.embedPlayer.getCurrentTime()||0;if(" "==e.key)return console.log("Try to pause video from space"),this.togglePause(),e.preventDefault(),!1;if("ArrowLeft"==e.key&&this.vodLength&&void 0!==this.embedPlayer.getCurrentTime())return this.seek(Math.min(Math.max(t-10,0),this.vodLength)),e.preventDefault(),!1;if("ArrowRight"==e.key&&this.vodLength&&this.embedPlayer.getCurrentTime())return this.seek(Math.min(Math.max(t+10,0),this.vodLength)),e.preventDefault(),!1}})),console.debug("Added hooks"),this.loadSettings()}timeFormat(e){const t=new Date;return t.setSeconds(e),t.toISOString().substr(11,8)}alignChat(e){this.elements.comments&&(this.elements.comments.classList.remove("left","right"),this.elements.comments.classList.add(e))}alignText(e){this.elements.comments&&(this.elements.comments.classList.remove("text-left","text-right"),this.elements.comments.classList.add("text-"+e))}saveSettings(){localStorage.setItem("settings",JSON.stringify(this.settings)),console.debug("Saved settings"),alert("Saved settings")}loadSettings(){const e=localStorage.getItem("settings");e?(this.settings=JSON.parse(e),console.debug("Loaded settings")):console.debug("No settings to load"),console.debug("Load settings",this.settings)}resetSettings(){this.settings={...os}}debug(...e){}generateHash(){const e=new URLSearchParams;return this.video_source&&(e.append("source",this.video_source),"twitch"==this.video_source&&e.append("twitch_id",this.video_id),"youtube"==this.video_source&&e.append("youtube_id",this.video_id),"file_http"==this.video_source&&e.append("video_path",this.video_id)),"file_http"==this.chat_source&&e.append("chatfile",this.chat_id),console.log("generateHash",e),`#${e.toString()}`}get videoPosition(){if(!this.embedPlayer)return 0;const e=this.embedPlayer.getCurrentTime(),t=this.embedPlayer.getDuration();return null===e||null===t?0:e/t}get videoCurrentTime(){return this.embedPlayer?.getCurrentTime()?this.embedPlayer.getCurrentTime():0}}console.log("app.vue init");var ls=(0,n.aZ)({name:"App",components:{ChatMessage:Vt,VideoControls:Yt},data(){return{vp:null,video_source:"file",chat_source:"file",input_video:"",input_chat:"",video_height:720}},async mounted(){console.log("Vod player mounted",this.video_height);const e=new as;this.vp=e,e.elements.viewer=document.getElementById("viewer"),e.elements.player=document.getElementById("player"),e.elements.video=document.getElementById("video"),e.elements.comments=document.getElementById("comments"),e.hooks(),await(0,n.Y3)(),window.addEventListener("hashchange",this.processHash),this.processHash()},methods:{processHash(e){console.debug("Process hash",window.location.hash,e);const t=this.vp;if(!t)return;const s=window.location.hash,i=s.split("&"),n={};for(const o of i)n[o.split("=")[0].replace("#","")]=o.split("=")[1];if(n.tci&&(t.settings.twitchClientId=n.tci),n.ts&&(t.settings.twitchSecret=n.ts),n.tk&&(t.settings.twitchToken=n.tk),n.offset&&(t.chatOffset=parseInt(n.offset)),t.minimal=void 0!==n.minimal&&parseInt(n.minimal)>0,n.chapters){t.videoChapters=[];const e=n.chapters.split(";");for(const s of e){const e=s.split(":"),i={time:parseInt(e[0]),label:e[1]};console.log("add chapter",i),t.videoChapters.push(i)}console.log(t.videoChapters)}if(n.source){const e=n.source;if(console.debug("automate playback"),t.automated=!0,"youtube"==e)window.onYouTubeIframeAPIReady=()=>{t.embedPlayer=new Jt(n.youtube_id)};else if("twitch"==e)t.embedPlayer=new Gt(n.twitch_id);else{if("file_http"!=e)return alert("No video source set"),!1;t.embedPlayer=new Kt(n.video_path)}if(t.embedPlayer&&(t.embedPlayer.vodplayer=t,t.embedPlayer.setup()),n.chatdump&&t.embedPlayer)t.loadTwitchChat(n.chatdump).then((e=>{console.log("auto chat load 1",e),n.offset&&t.seek(parseInt(n.offset))}));else{if(!n.chatfile||!t.embedPlayer)return alert("No chat source set"),!1;t.embedPlayer.addEventListener("ready",(()=>{console.debug("player ready, load chat file"),t.loadChatFileFromURL(n.chatfile).then((e=>{console.log("auto chat load 2",e),n.offset&&t.seek(parseInt(n.offset))}))}))}}},submitVideo(e){if(this.vp)return console.log(this.$refs),this.vp.loadVideo(this.video_source,this.$refs.video_input),e.preventDefault(),!1},submitChat(e){if(this.vp)return console.log(this.$refs),this.vp.loadChat(this.chat_source,this.$refs.chat_input),e.preventDefault(),!1},fetchTwitchToken(){this.vp&&this.vp.fetchTwitchToken()},alignChat(e){this.vp&&this.vp.alignChat(e)},alignText(e){this.vp&&this.vp.alignText(e)},apply(){this.vp&&this.vp.applyTimings()},saveSettings(){this.vp&&this.vp.saveSettings()},resetSettings(){this.vp&&this.vp.resetSettings()},generateLink(){this.vp&&alert(`${location.protocol}//${location.host}${location.pathname}${this.vp.generateHash()}`)}},computed:{videoPosition(){const e=this.vp?.embedPlayer?.getCurrentTime()||0;return e/(this.vp?.vodLength||0)},commentsStyle(){return this.vp?{top:this.vp.settings.chatTop+"%",bottom:this.vp.settings.chatBottom+"%",width:this.vp.settings.chatWidth+"%",fontSize:this.vp.settings.fontSize+"px",fontFamily:this.vp.settings.fontName}:{}},commentsClass(){return this.vp?{"align-left":"left"==this.vp.settings.chatAlign,"align-right":"right"==this.vp.settings.chatAlign,"text-left":"left"==this.vp.settings.chatTextAlign,"text-right":"right"==this.vp.settings.chatTextAlign,[this.vp.settings.chatStyle]:!0,"has-stroke":this.vp.settings.chatStroke,"is-overlay":this.vp.settings.chatOverlay}:{}},twitchApiRequired(){return"twitch"==this.video_source||"twitch"==this.chat_source}}});const rs=(0,Lt.Z)(ls,[["render",vt]]);var hs=rs,cs=s(749),ds=(0,cs.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,i.ri)(hs).use(ds).mount("#app")}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,o){if(!i){var a=1/0;for(c=0;c<e.length;c++){i=e[c][0],n=e[c][1],o=e[c][2];for(var l=!0,r=0;r<i.length;r++)(!1&o||a>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[r])}))?i.splice(r--,1):(l=!1,o<a&&(a=o));if(l){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,n,o]}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,o,a=i[0],l=i[1],r=i[2],h=0;if(a.some((function(t){return 0!==e[t]}))){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(r)var c=r(s)}for(t&&t(i);h<a.length;h++)o=a[h],s.o(e,o)&&e[o]&&e[o][0](),e[a[h]]=0;return s.O(c)},i=self["webpackChunktwitch_vod_chat"]=self["webpackChunktwitch_vod_chat"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(812)}));i=s.O(i)})();
//# sourceMappingURL=app.e8954ac3.js.map